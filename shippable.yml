# Language setting
language: node_js

build:
  ci:
    - echo 'CI is running'
  post_ci:
      # ECR
      - docker build -t="smallfish/auth:$BRANCH.$BUILD_NUMBER" .
      - docker tag smallfish/auth:$BRANCH.$BUILD_NUMBER 315671387076.dkr.ecr.eu-west-1.amazonaws.com/smallfish/auth:$BRANCH.$BUILD_NUMBER
      - docker push 315671387076.dkr.ecr.eu-west-1.amazonaws.com/smallfish/auth:$BRANCH.$BUILD_NUMBER

integrations:
  deploy:
    # Private Image (ECR)
    - integrationName: "AWS"
      type: aws
      target: eb_docker
      application_name: "smallfish/auth"
      env_name: "ecr-env"
      region: "eu-west-1"
      image_name: "315671387076.dkr.ecr.eu-west-1.amazonaws.com/smallfish/auth"
      image_tag: "$BRANCH.$BUILD_NUMBER"

  hub:
    - integrationName: "AWS ECR"
      type: ecr
