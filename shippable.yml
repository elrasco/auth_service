# Language setting
language: node_js

env:
  global:
    REGISTRY_ACCESS_KEY="DvRKLV4Xk3jpB4DgsP/p9W3iyt8NoMM4OxPtfexN"
    REGISTRY_SECRET_KEY="AKIAJFKJMCZC3VNDMSIA"
    REGISTRY_REGION="eu-west-1"


build:
  ci:
    - echo 'CI is running'
  post_ci:
      # ECR
      - docker build -t="smallfish/auth:$BRANCH.$BUILD_NUMBER" .
      - docker tag smallfish/auth:$BRANCH.$BUILD_NUMBER 315671387076.dkr.ecr.eu-west-1.amazonaws.com/smallfish/auth:$BRANCH.$BUILD_NUMBER
      - docker push 315671387076.dkr.ecr.eu-west-1.amazonaws.com/smallfish/auth:$BRANCH.$BUILD_NUMBER

integrations:
  hub:
    - integrationName: "AWS ECR"
      type: ecr


